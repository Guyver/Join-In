<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OpenNI 1.5.4: SimpleRead.java - sample program (Java)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="main.html">OpenNI Overview</a>&nbsp;&raquo;&nbsp;<a class="el" href="smpls__n__guides.html">Samples and Guides</a>&nbsp;&raquo;&nbsp;<a class="el" href="smpls.html">Sample Programs for the OpenNI API</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="smpl_simple_read_java">SimpleRead.java - sample program (Java) </a></h1><p><b>Source file:</b> Click the following link to view the source code file:</p>
<ul>
<li>SimpleRead.java</li>
</ul>
<p>This part describes the SimpleRead sample program in the Java language.</p>
<p>The documentation describes the sample program's code from the top of the program file(s) to bottom.</p>
<p>Every OpenNI feature is described the first time it appears in this sample program. Further appearances of the same feature are not decribed again.</p>
<h2><a class="anchor" id="srj_path_decl">
Declaration for Script File Path</a></h2>
<p>The following declaration sets the full path to an OpenNI XML script file of a OpenNI <a class="el" href="prod__graph.html">production graph</a>. The production graph is the main object model in OpenNI. It is a network of objects &ndash; called production nodes that implement Natural Interaction operations. </p>
<div class="fragment"><pre class="fragment">            <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SAMPLES_XML = <span class="stringliteral">&quot;../../../../Data/SamplesConfig.xml&quot;</span>;
</pre></div><h2><a class="anchor" id="srj_node_inits">
Node Declarations and Initializations</a></h2>
<p>The following statement declares a <a class="el" href="classxn_1_1_script_node.html">ScriptNode</a> object. The script node object loads and contains the OpenNI script and is the base node for the production graph. The <em>production graph</em> is a network of <em>production nodes</em> and is the principal OpenNI object model. </p>
<div class="fragment"><pre class="fragment">            OutArg&lt;ScriptNode&gt; scriptNodeArg = <span class="keyword">new</span> OutArg&lt;ScriptNode&gt;();
</pre></div><p>The following statement declares a <a class="el" href="classxn_1_1_context.html">Context</a> object and creates the production graph from an OpenNI XML script file. The context is the workspace where the application builds an OpenNI production graph. </p>
<div class="fragment"><pre class="fragment">            Context context = Context.createFromXmlFile(SAMPLES_XML, scriptNodeArg);
</pre></div><p>The following statement registers an event handler for the 'Global Error State Change' event. The <b>Error State</b> capability allows a node implementation to notify OpenNI that it is in an error state, meaning it cannot function properly. An application can check each node's error state separately, but most of the times the application only needs to know if any one of the nodes is in an error state, and does not really care which one or how many (except for user notification purposes).</p>
<p>OpenNI aggregates the error state of all the nodes together into a single error state, the Global Error State, making it easier for the application to find out about current state. When the Global Error State is <code>XN_STATUS_OK</code> this means <em>all</em> the nodes are OK. </p>
<div class="fragment"><pre class="fragment">            context.getErrorStateChangedEvent().addObserver(pThis);
</pre></div><p>The <a class="el" href="classxn_1_1_context.html#a48450b0fde8c947c8ba7683a4f882308">FindExistingNode()</a> method in the following code block tries to get a reference to any production nodes in the production graph. This call specifies XN_NODE_TYPE_DEPTH to get a reference to a DepthGenerator node. A DepthGenerator node generates a depth map as an array of pixels, where each pixel is a depth value representing a distance from the sensor in millimeters. A reference to the node is returned in the depth parameter. </p>
<div class="fragment"><pre class="fragment">            DepthGenerator depth;
            nRetVal = context.FindExistingNode(<a class="code" href="_xn_types_8h.html#ac773bbb9817dac5ae1be0f380ec18b52a1415a428ab99e92cebedd4fdb1fe74c6">XN_NODE_TYPE_DEPTH</a>, depth);
</pre></div><p>The following is the declaration of the <a class="el" href="glossary.html#glos_frame_object">&lt;i&gt;frame object&lt;/i&gt;</a> for quick and easy access to data from the <a class="el" href="classxn_1_1_depth_generator.html">DepthGenerator</a> data. </p>
<div class="fragment"><pre class="fragment">            DepthMetaData depthMD = <span class="keyword">new</span> DepthMetaData();
</pre></div><h2><a class="anchor" id="smpl_simple_read_mainloop">
Main Program Loop</a></h2>
<p>The main program loop repeatedly updates the data available in the node for output, and then gets the frame object (via the metadata object). The program then calculates the mid-point of the scene's 2D (two-dimensional) area.</p>
<h3><a class="anchor" id="srj_main_upd_data">
Updating the Data Available for Output</a></h3>
<p>The <a class="el" href="classxn_1_1_context.html#a17fab043d7b6d60728511527a1d5c090">waitAnyUpdateAll()</a> method in the following statement updates all generator nodes in the context that have new data available, first waiting for any of the nodes to have new data available. The application can then get the data (for example, using a metadata GetData() method). This method has a timeout. </p>
<div class="fragment"><pre class="fragment">                context.waitAnyUpdateAll();
</pre></div><h3><a class="anchor" id="srj_main_get">
Get the DepthGenerator's Data</a></h3>
<p>In the following statement, the <a class="el" href="glossary.html#glos_frame_object">frame object</a> is generated is copied to a metadata object for quick and easy access by the application. (To be exact, only a reference to the frame data itself is passed; whereas the configuration properties are actually copied.) The node's <code>getMetaData() </code>method gets this frame object and copies it to a <code>depthMD</code> metadata object. (It passes a reference to the frame data and actually copies the frame configuration information. The metadata includes all configuration information associated with the data itself. ) </p>
<div class="fragment"><pre class="fragment">                depth.GetMetaData(depthMD);
</pre></div><p>The following print statement accesses the frame data, its ID, and the frame data's associated configuration, The frame ID is the ID of the generated frame. Frame IDs are a sequential unique number with a wrap around. This method is inherited from the OutputMetaData class. </p>
<div class="fragment"><pre class="fragment">                printf(<span class="stringliteral">&quot;Frame %d Middle point is: %u. FPS: %f\n&quot;</span>, depthMD.FrameID(), depthMD(depthMD.XRes() / 2, depthMD.YRes() / 2), <a class="code" href="_xn_f_p_s_calculator_8h.html#ad86193813c6c0fa46610cf3bea64c550">xnFPSCalc</a>(&amp;xnFPS));
</pre></div><p>In the above, <a class="el" href="classxn_1_1_map_meta_data.html#a88773e165cbc69e091e87781ca43bdb7">XRes()</a> and <a class="el" href="classxn_1_1_map_meta_data.html#a59e8d198dada0c527436196592dc320c">YRes()</a> are the dimensions of the FOV in the scene. The call to <b>depthMD()</b> accesses a depth pixel through an X,Y coordinate. By calculating <b>XRes()/2</b> and <b>YRes()/2</b>, this accesses the middle pixel. </p>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Wed Jun 13 21:55:36 2012 for OpenNI 1.5.4 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
