<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OpenNI 1.5.4: NiSimpleCreate.cpp - sample program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="main.html">OpenNI Overview</a>&nbsp;&raquo;&nbsp;<a class="el" href="smpls__n__guides.html">Samples and Guides</a>&nbsp;&raquo;&nbsp;<a class="el" href="smpls.html">Sample Programs for the OpenNI API</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="smpl_simple_create">NiSimpleCreate.cpp - sample program </a></h1><p><b>Source file:</b> Click the following link to view the source code file:</p>
<ul>
<li>NiSimpleCreate.cpp</li>
</ul>
<p>This section describes the NiSimpleCreate sample program. This sample program is similar to NiSimpleRead, but sets up a production graph using function calls instead of an XML file.</p>
<p>This sample program is similar to NiSimpleRead, but sets up a production graph using function calls instead of an XML file.</p>
<h2><a class="anchor" id="sc_ftrs">
Key Features of the Sample Program</a></h2>
<p>This sample program demonstrates how to set up an OpenNI production graph These are the features and concepts demonstrated by the sample program:</p>
<ul>
<li>The OpenNI production graph</li>
<li>Setting up a production graph by using function calls</li>
<li>Node types: DepthGenerator node</li>
<li>Metadata ("frame objects")</li>
<li>Context</li>
<li>Method status returns and errors - At every stage of the program, error checking is performed</li>
</ul>
<h2><a class="anchor" id="sc_glb_dcl_blk">
Global Declaration Block</a></h2>
<p>The context initialization block of code at the top of the program declares and initializes a Context object. A context is a work space where you build your OpenNI production graph </p>
<div class="fragment"><pre class="fragment">            <a class="code" href="_xn_status_8h.html#a23967099202ddb640cd2044b3808253c">XnStatus</a> nRetVal = <a class="code" href="_xn_status_8h.html#a92729089d8e28e740a3f8b5169c8f695">XN_STATUS_OK</a>;
            Context context;

            nRetVal = context.Init();
            CHECK_RC(nRetVal, <span class="stringliteral">&quot;Initialize context&quot;</span>);
</pre></div><h2><a class="anchor" id="sc_cntxt_init">
Initializing a Context</a></h2>
<p>The context initialization block of code at the top of the program declares and initializes a Context object. A context is a work space where you build your OpenNI production graph </p>
<div class="fragment"><pre class="fragment">            <a class="code" href="_xn_status_8h.html#a23967099202ddb640cd2044b3808253c">XnStatus</a> nRetVal = <a class="code" href="_xn_status_8h.html#a92729089d8e28e740a3f8b5169c8f695">XN_STATUS_OK</a>;
            Context context;

            nRetVal = context.Init();
            CHECK_RC(nRetVal, <span class="stringliteral">&quot;Initialize context&quot;</span>);
</pre></div><h2><a class="anchor" id="sc_crt_pg">
Creating a Production Graph</a></h2>
<p>A production graph is created by creating at least one node. Ibn this acse it is a DepthGenerator node. A DepthGenerator node generates depth maps. Depth maps are data frames of pixels, where each pixel value is its distance from the sensor in millimeters. </p>
<div class="fragment"><pre class="fragment">        DepthGenerator depth;
        nRetVal = depth.Create(context);
</pre></div><p> The following code block is a call to a macro. It simply checks that the return code reports a successful execution, and if not prints an error message and stops the application execution, returning control to the operating system.</p>
<h2><a class="anchor" id="sc_entr_node_to_gen_state">
Entering the Node into 'Generating state'</a></h2>
<p>The following function call enters the production graph into 'Generating state'. This causes the nodes in the production graph to start generating data (by default, when a generator node is created, it's not generating any new data. This allows an application to configure it before actually starting it. </p>
<div class="fragment"><pre class="fragment">        nRetVal = context.StartGeneratingAll();
</pre></div><h2><a class="anchor" id="sc_decl_dg_fo">
Declaring the DepthGenerator Frame Object</a></h2>
<p>The application accesses the DepthGenerator node's data and associated configuration through the node's frame object (provided by the metadata object). This frame object provides fast access to a stored <a class="el" href="glossary.html#glos_frame_object">frame object</a> data and its associated configuration. </p>
<div class="fragment"><pre class="fragment">        DepthMetaData depthMD;
</pre></div><p>3.6 Main Program Loop</p>
<h2><a class="anchor" id="sc_main_loop">
Main Program Loop</a></h2>
<p>The main program loop keeps going forever, or until somebody presses a keyboard key. The main body of the program is all within this loop.</p>
<p>The program repeatedly updates the data available in the node for output, and then gets the frame object (via the metadata object). The program then calculates the mid-point of the scene's 2D (two-dimensional) area. </p>
<div class="fragment"><pre class="fragment">        <span class="keywordflow">while</span> (!<a class="code" href="_xn_o_s_8h.html#ab056c1114eb753d8c40df4b8f9bae043">xnOSWasKeyboardHit</a>())
        {
         &lt; main program body &gt; 
        }
</pre></div><h3><a class="anchor" id="sc_main_loop_update_data">
Updating the Data Available for Output</a></h3>
<p>The following call to a 'Wait X Update All' method updates the data available for output. The WaitOneUpdateAll() method updates all generator nodes in the context that have new data available, first waiting for a specified node to have new data available. The application then reads this data through the frame object. </p>
<div class="fragment"><pre class="fragment">                nRetVal = context.WaitOneUpdateAll(depth);
</pre></div><h3><a class="anchor" id="sc_main_loop_get_dg_fo">
Getting the DepthGenerator's Frame Object</a></h3>
<p>The DepthGenerator node's frame object contains the depth map as an array of pixels. The data is accessed though the Data() method (see later). This method returns a pointer to the first depth pixel in the map.</p>
<p>The following call to the <a class="el" href="classxn_1_1_depth_generator.html#a0e05087d3c1652e6f7fa4c002807a22a">GetMetaData()</a> method gets the node's latest frame object, saving it as a metadata object. The frame object contains the depth map, which is an array of pixels. This call is central in the use of the DepthGenerator node &ndash; and in all generator nodes that make use of a metadata object. </p>
<div class="fragment"><pre class="fragment">                depth.GetMetaData(depthMD);
</pre></div><h3><a class="anchor" id="sc_main_loop_get_dg_data_a_cfg">
Getting the Depth Data and Configuration</a></h3>
<p>The following print statement accesses the frame data, its ID, and some attributes of the frame data's associated configuration. The frame ID is the ID of the frame object. XRes() and YRes() are from the frame configuration; they are the resolution of the FOV in the scene.</p>
<p>The call to depthMD() accesses a depth pixel through an (X,Y) coordinate. By calculating XRes()/2 and YRes()/2, this accesses the middle pixel. </p>
<div class="fragment"><pre class="fragment">                printf(<span class="stringliteral">&quot;Frame %d Middle point is: %u. FPS: %f\n&quot;</span>, depthMD.FrameID(), 
                    depthMD(depthMD.XRes() / 2, depthMD.YRes() / 2), 
                    <a class="code" href="_xn_f_p_s_calculator_8h.html#ad86193813c6c0fa46610cf3bea64c550">xnFPSCalc</a>(&amp;xnFPS));
</pre></div><h2><a class="anchor" id="sc_rel_objs">
Releasing the Objects</a></h2>
<p>At the conclusion of the program, the following code block unreferences the context and the production node, decreasing its reference count by 1. If the reference count reaches zero, the node or context will be destroyed. </p>
<div class="fragment"><pre class="fragment">            depth.Release();
            context.Release();
</pre></div> </div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Wed Jun 13 21:55:36 2012 for OpenNI 1.5.4 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
