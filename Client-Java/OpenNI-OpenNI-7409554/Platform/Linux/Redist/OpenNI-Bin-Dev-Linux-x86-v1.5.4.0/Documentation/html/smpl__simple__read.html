<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OpenNI 1.5.4: NiSimpleRead.cpp - sample program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="main.html">OpenNI Overview</a>&nbsp;&raquo;&nbsp;<a class="el" href="smpls__n__guides.html">Samples and Guides</a>&nbsp;&raquo;&nbsp;<a class="el" href="smpls.html">Sample Programs for the OpenNI API</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="smpl_simple_read">NiSimpleRead.cpp - sample program </a></h1><p><b>Source file:</b> Click the following link to view the source code file:</p>
<ul>
<li>NiSimpleRead.cpp</li>
</ul>
<p>This section describes the SimpleRead sample program.</p>
<h2><a class="anchor" id="sr_glb_dcl_blk">
Global Declaration Block</a></h2>
<p>The declaration block at the top of the program declares a Context object, a ScriptNode object, and an EnumerationErrors object. The context is workspace where the application builds an OpenNI production graph. The script node object loads and contains the OpenNI script and is the base node for the production graph. The <em>production graph</em> is a network of <em>production nodes</em> and is the principal OpenNI object model. The EnumerationErrors and XnStatus object types are for collecting errors from any of the OpenNI functions. Also declared is an OpenNI status flag for collecting return values from method calls. </p>
<div class="fragment"><pre class="fragment">            <a class="code" href="_xn_status_8h.html#a23967099202ddb640cd2044b3808253c">XnStatus</a> nRetVal = <a class="code" href="_xn_status_8h.html#a92729089d8e28e740a3f8b5169c8f695">XN_STATUS_OK</a>;
            Context context;
            ScriptNode scriptNode;
            EnumerationErrors errors;
</pre></div><h2><a class="anchor" id="sr_func_main">
Main Program</a></h2>
<h3><a class="anchor" id="sr_scrpt_sets_up_pg">
Use Script to Set up a Context and Production Graph</a></h3>
<p>The <a class="el" href="classxn_1_1_context.html#aa0f2dff24c434ed56b44332456ea9502">InitFromXmlFile()</a> method is a shorthand combination of two other initialization methods &mdash; <a class="el" href="classxn_1_1_context.html#adfc68c424c840a788d0903e20a95e541">Init()</a> and then <a class="el" href="classxn_1_1_context.html#a0145a926d2656d0f05399ed8d5f90ec6">RunXmlScriptFromFile()</a> &mdash; which initializes the context object and then creates a production graph from an XML file. The XML script file describes all the nodes you want to create. For each node description in the XML file, this method creates a node in the production graph. </p>
<div class="fragment"><pre class="fragment">                nRetVal = context.InitFromXmlFile(fn, scriptNode, &amp;errors);
</pre></div><h3><a class="anchor" id="sr_ver_nodes_in_script">
Verify Existence of Nodes in the Sample Script File</a></h3>
<p>Summary: This code is some more verification code. This time it checks that OpenNI found at least one node definition in the script file. The program continues execution only if at least one node definition if found. </p>
<div class="fragment"><pre class="fragment">            <span class="keywordflow">if</span> (nRetVal == XN_STATUS_NO_NODE_PRESENT)
                {
                    XnChar strError[1024];
                    ...
                }
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nRetVal != <a class="code" href="_xn_status_8h.html#a92729089d8e28e740a3f8b5169c8f695">XN_STATUS_OK</a>)
                {
                    printf(<span class="stringliteral">&quot;Open failed: %s\n&quot;</span>, <a class="code" href="_xn_status_8h.html#a709a2190465f4a6d7893587e53d66798">xnGetStatusString</a>(nRetVal));
                    <span class="keywordflow">return</span> (nRetVal);
                }
            }
</pre></div><h3><a class="anchor" id="sr_get_node_from_pg">
Get a Node from the Production Graph</a></h3>
<p>Assuming that the above call to <a class="el" href="classxn_1_1_context.html#aa0f2dff24c434ed56b44332456ea9502">InitFromXmlFile()</a> succeeded, a production graph is then created.</p>
<p>The <a class="el" href="classxn_1_1_context.html#a48450b0fde8c947c8ba7683a4f882308">FindExistingNode()</a> method in the following code block tries to get a reference to any one of the production nodes. This call specifies XN_NODE_TYPE_DEPTH to get a reference to a <a class="el" href="classxn_1_1_depth_generator.html">DepthGenerator</a> node. A DepthGenerator node generates a depth map as an array of pixels, where each pixel is a depth value representing a distance from the sensor in millimeters. A reference to the node is returned in the depth parameter. </p>
<div class="fragment"><pre class="fragment">                DepthGenerator depth = (DepthGenerator)context.findExistingNode(NodeType.DEPTH);
</pre></div><h3><a class="anchor" id="sr_init_fps_calc">
Initialize the FPS Calculator</a></h3>
<p>The following declaration block initializes the FPS Calculator. </p>
<div class="fragment"><pre class="fragment">                <a class="code" href="_xn_f_p_s_calculator_8h.html#ae5870d3d50dec1e2c2af17f976ba3f8f">XnFPSData</a> xnFPS;
                nRetVal = <a class="code" href="_xn_f_p_s_calculator_8h.html#a666d04413f1febe01823fcb320fcbb9b">xnFPSInit</a>(&amp;xnFPS, 180);
</pre></div><h3><a class="anchor" id="sr_decl_dg_fo">
Declare the DepthGenerator's Frame Object</a></h3>
<p>The following statement declares a metadata object to provide a <a class="el" href="glossary.html#glos_frame_object">frame object</a> for the <a class="el" href="classxn_1_1_depth_generator.html">xn::DepthGenerator</a> node. A <a class="el" href="glossary.html#dict_gen_node">generator node's</a> <a class="el" href="glossary.html#glos_frame_object">frame object</a> contains a generated data frame and all its associated properties. This frame object, comprising the data frame and its properties, is accessible through the node's metadata object. </p>
<div class="fragment"><pre class="fragment">                DepthMetaData depthMD;
</pre></div><h3><a class="anchor" id="sr_main_prg_loop">
Main Program Loop</a></h3>
<p>The main program loop repeatedly updates the data available in the node for output, and then gets the frame object (via the metadata object). The program then calculates the mid-point of the scene's 2D (two-dimensional) area.</p>
<h4><a class="anchor" id="sr_main_upd_data">
Updating the Data Available for Output</a></h4>
<p>the <a class="el" href="classxn_1_1_context.html#ad4bab84f35a855639d485da99a05c585">WaitOneUpdateAll()</a> method in the following statement updates all generator nodes in the context that have new data available, first waiting for a specified node to have new data available. The application can then get the data (for example, using a metadata GetData() method). This method has a timeout. </p>
<div class="fragment"><pre class="fragment">                    nRetVal = context.WaitOneUpdateAll(depth);
</pre></div><h4><a class="anchor" id="sr_main_mark_the_frame">
Mark the Frame</a></h4>
<div class="fragment"><pre class="fragment">                    <a class="code" href="_xn_f_p_s_calculator_8h.html#a608895501083570d61c91395db6b24db">xnFPSMarkFrame</a>(&amp;xnFPS);
</pre></div><h4><a class="anchor" id="sr_main_get_data">
Get the DepthGenerator's Data</a></h4>
<p>The following statement gets the latest generated depth <a class="el" href="glossary.html#glos_frame_object">frame object</a>, saving it as a metadata object. </p>
<div class="fragment"><pre class="fragment">                    depth.GetMetaData(depthMD);
</pre></div><p>The following print statement accesses the frame data, its ID, and the frame data's associated configuration, The frame ID is the ID of the frame object. Frame IDs are a sequential unique number with a wrap around. This method is inherited from the OutputMetaData class. </p>
<div class="fragment"><pre class="fragment">                    printf(<span class="stringliteral">&quot;Frame %d Middle point is: %u. FPS: %f\n&quot;</span>, depthMD.FrameID(), depthMD(depthMD.XRes() / 2, depthMD.YRes() / 2), <a class="code" href="_xn_f_p_s_calculator_8h.html#ad86193813c6c0fa46610cf3bea64c550">xnFPSCalc</a>(&amp;xnFPS));
</pre></div><p>In the above, <a class="el" href="classxn_1_1_map_meta_data.html#a88773e165cbc69e091e87781ca43bdb7">XRes()</a> and <a class="el" href="classxn_1_1_map_meta_data.html#a59e8d198dada0c527436196592dc320c">YRes()</a> are the dimensions of the FOV in the scene. The call to <b>depthMD()</b> accesses a depth pixel through an X,Y coordinate. By calculating <b>XRes()/2</b> and <b>YRes()/2</b>, this accesses the middle pixel. </p>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Wed Jun 13 21:55:36 2012 for OpenNI 1.5.4 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
