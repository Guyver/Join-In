<!--
	@Author: Santiago Hors Fraile
-->
<html>
<head>
	<title> JoinIn </title>
	<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
			
</head>

<body>

<script src="/socket.io/socket.io.js"></script><!-- Passed from the server -->
<script>
	
	var socket= io.connect('193.156.105.162:7541');
	function getCookie(c_name)
	{
	var i,x,y,ARRcookies=document.cookie.split(";");
	for (i=0;i<ARRcookies.length;i++)
	  {
	  x=ARRcookies[i].substr(0,ARRcookies[i].indexOf("="));
	  y=ARRcookies[i].substr(ARRcookies[i].indexOf("=")+1);
	  x=x.replace(/^\s+|\s+$/g,"");
	  if (x==c_name)
	    {
	    return unescape(y);
	    }
	  }
}
	
	var userKey= getCookie("userKey");
	
	socket.emit('giveMeUserPictures',userKey);	

	//Callback functions
	socket.on('sendingUserPictures',function(images) {	
		
		var parsedImages=images;
		
		document.write("<div id=\"container\" style=\"width:464px; margin:auto;\">");			
			
		for(index in images){
			
			
			document.write("<div id=\"div_"+parsedImages[index].userKey+"\" style=\"background-color:grey; width:100px;height:100px; float:left; border:solid; margin:5px;\"> ");
			document.write("<img src=\""+parsedImages[index].image+"\" type=\"image\" id=\""+parsedImages[index].userKey+"\" title=\"Image of the user "+parsedImages[index].userKey+"\" width=\"100\" height=\"85\"\\/\\>");
			document.write("</div>");
		}
		document.write("</div>");
			
	});

	socket.on('updateNewUser',function(user) {
		var parsedUser=JSON.parse(user);
		document.getElementById(parsedUser.userKey).src=parsedUser.connectedImageUrl;				
	});
	
	socket.on("userReady", function(userKey){

		console.log("USER READY");
	/*
		var parsedUserKey=JSON.parse(userKey);
		var divName= "div_"+parsedUserKey;
		console.log("Accesing "+document.getElementById(divName));
		console.log("whose style is"+document.getElementById(divName).style);
		console.log("whose background is"+document.getElementById(divName).style.background);
		document.getElementById(divName).style.backgroundColor='green'; 
		
		*/
		
	});
	socket.on('userNotReady', function(userKey){
		var parsedUserKey=JSON.parse(userKey);
		var divName= "div_"+parsedUserKey;
		//document.getElementById(divName).style="background-color:grey; width:100px;height:100px; float:left; border:solid; margin:5px;";
		document.getElementById(divName).style.backgroundColor='grey'; 
	});
	/*socket.on('deleteHim',function(player){
		
		//To avoid the double call.			
		if(player!=null){
			document.getElementById(player.userKey).src=player.disconnectedImageUrl;	
		}else{
			console.log("Controlled error...");			
		}	
	});*/
	</script>


	
	
	
</body>

</html>
