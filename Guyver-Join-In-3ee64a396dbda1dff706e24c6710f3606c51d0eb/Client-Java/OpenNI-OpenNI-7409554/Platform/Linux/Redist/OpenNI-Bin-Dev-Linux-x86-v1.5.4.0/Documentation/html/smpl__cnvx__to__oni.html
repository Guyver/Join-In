<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OpenNI 1.5.4: NiConvertXToONI.cpp - sample program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="main.html">OpenNI Overview</a>&nbsp;&raquo;&nbsp;<a class="el" href="smpls__n__guides.html">Samples and Guides</a>&nbsp;&raquo;&nbsp;<a class="el" href="smpls.html">Sample Programs for the OpenNI API</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="smpl_cnvx_to_oni">NiConvertXToONI.cpp - sample program </a></h1><p><b>Source file:</b> Click the following link to view the source code file:</p>
<ul>
<li>NiConvertXToONI.cpp</li>
</ul>
<p>The program opens any recording, takes every node in this recording, and records it to a new ONI recording. It receives both input file and output file from the command line.</p>
<p>The documentation describes the sample program's code from the top of the program file(s) to bottom.</p>
<p>Every OpenNI feature is described the first time it appears in this sample program. Further appearances of the same feature are not decribed again.</p>
<h2><a class="anchor" id="cnvx2o_mainprg">
main() â€“ Main Program</a></h2>
<h3><a class="anchor" id="cnvx2o_mainprg_dcl_blk">
Main Program Declaration Block</a></h3>
<p>The following code block sets the limits for the main program loop later in the program.</p>
<p>Setting seekNodeType to <a class="el" href="_xn_types_8h.html#ac773bbb9817dac5ae1be0f380ec18b52aecbdd244701d5cf6f3333faae8d235dd">xn::XN_NODE_TYPE_INVALID</a> "XN_NODE_TYPE_INVALID" is an initialization for <code>seekNodeType</code> gets from the users run arguments an indication whether the user wants to play back all nodes or just one specified node. The XN_NODE_TYPE_INVALID value for <code>seekNodeType</code> initialization makes the program play back all nodes. </p>
<div class="fragment"><pre class="fragment">                XnUInt32 nStartFrame = 1;
                XnUInt32 nEndFrame = XN_MAX_UINT32;
                <a class="code" href="_xn_types_8h.html#ab786f8128488cec584d72c2642655e39">XnProductionNodeType</a> seekNodeType = <a class="code" href="_xn_types_8h.html#ac773bbb9817dac5ae1be0f380ec18b52aecbdd244701d5cf6f3333faae8d235dd">XN_NODE_TYPE_INVALID</a>;
</pre></div><h3><a class="anchor" id="cnvx2o_get_prod_node">
Get a Production Node From a String</a></h3>
<p>If the node type parameter (the third command line parameter) is specified, we translate the node type from a string to an XnProductionNodeType value using <a class="el" href="group__utils.html#ga008e328025255d260f225953056459d9">xnProductionNodeTypeFromString()</a>. </p>
<div class="fragment"><pre class="fragment">                <span class="keywordflow">if</span> (argc &gt;= 4)
                {
                    strNodeType = argv[3];
                    nRetVal = <a class="code" href="group__utils.html#ga008e328025255d260f225953056459d9">xnProductionNodeTypeFromString</a>(strNodeType, &amp;seekNodeType);
                    <span class="keywordflow">if</span> (nRetVal != <a class="code" href="_xn_status_8h.html#a92729089d8e28e740a3f8b5169c8f695">XN_STATUS_OK</a>)
                    {
                        ...
                    }
                    ...
                }       
</pre></div><p>The following initializes the <a class="el" href="classxn_1_1_context.html">xn::Context</a> object. This is where the application builds an OpenNI production graph. The <em>production graph</em> is a network of <em>production nodes</em> and is the principal OpenNI object structure. </p>
<div class="fragment"><pre class="fragment">                Context context;
                nRetVal = context.<a class="code" href="classxn_1_1_context.html#adfc68c424c840a788d0903e20a95e541" title="Builds the context&amp;#39;s general software environment.">Init</a>();
</pre></div><p>The following code uses the <a class="el" href="classxn_1_1_player.html">xn::Player</a> node to replay a recorded file of a session of OpenNI data generation exactly as it was recorded. <code>strInputFile</code> contains the input file name, as above.</p>
<p>The <a class="el" href="classxn_1_1_context.html#a3589979f63d5b9ddea49b71dcdf9fc5a">OpenFileRecording()</a> method replays a recorded file of a session of OpenNI data generation exactly as it was recorded. This includes recreating the whole <a class="el" href="prod__graph.html">production graph</a>, with all its nodes, that was built to run the original data generation session. </p>
<div class="fragment"><pre class="fragment">                Player player;
                nRetVal = context.OpenFileRecording(strInputFile, player);
</pre></div><p>In the following statement, the <a class="el" href="classxn_1_1_player.html#a9804065d8fafb2a69d2133ac207a09eb">SetPlaybackSpeed()</a> method sets the player's playback speed, as a ratio of the rate that the recording was made at. The value <a class="el" href="_xn_types_8h.html#a2daadd99b97dd4b64536b1fbd19fbd20">xn::XN_PLAYBACK_SPEED_FASTEST</a> (0.0) means that there will be no delay, and that frames will be returned immediately on demand. </p>
<div class="fragment"><pre class="fragment">                nRetVal = player.SetPlaybackSpeed(<a class="code" href="_xn_types_8h.html#a2daadd99b97dd4b64536b1fbd19fbd20">XN_PLAYBACK_SPEED_FASTEST</a>);
</pre></div><p>In the following statement, the <a class="el" href="classxn_1_1_player.html#ad334f5b33a039c12e489743b77ede8c7">EnumerateNodes()</a> method places in <code>nodes</code> the list of all nodes created by the earlier call to <a class="el" href="classxn_1_1_context.html#a3589979f63d5b9ddea49b71dcdf9fc5a">OpenFileRecording()</a>. </p>
<div class="fragment"><pre class="fragment">                NodeInfoList nodes;
                nRetVal = player.EnumerateNodes(nodes);
</pre></div><p>In the following, the call to <a class="el" href="classxn_1_1_recorder.html#a4d544321e6bcad40d68db50353a0d6ee">Create()</a> initializes a Recorder object. This object records to a specified destination medium the frames of data from each node that was added to the Recorder node. </p>
<div class="fragment"><pre class="fragment">                Recorder recorder;
                nRetVal = recorder.Create(context);
</pre></div><p>In the following statement, the call to <a class="el" href="classxn_1_1_recorder.html#a1e84f796966c9808b2a26db0d5dfe621">SetDestination()</a> specifies to where the recorder must send its recording. This is a disk file of ONI type. </p>
<div class="fragment"><pre class="fragment">                nRetVal = recorder.SetDestination(<a class="code" href="group__recorder.html#gga3a9ee4c35a7384ba06a4d22f976f8e8aab2fd201e9160a675b83ca2a3e4d36a0c">XN_RECORD_MEDIUM_FILE</a>, strOutputFile);
</pre></div><h3><a class="anchor" id="cnvx2o_for_add_all_nodes_to_the_recorder">
for() - Add all Nodes to the Recorder</a></h3>
<p>The following 'for' loop adds to the recorder all the nodes in the <a class="el" href="classxn_1_1_node_info_list.html">NodeInfoList</a> that were obtained from the earlier call to the <a class="el" href="classxn_1_1_player.html#ad334f5b33a039c12e489743b77ede8c7">EnumerateNodes()</a> method. A NodeInfoList object contains a list of <a class="el" href="classxn_1_1_node_info.html">NodeInfo</a> objects. The NodeInfo class contains information about a <a class="el" href="glossary.html#node_alternative">node</a>, whether it is an existing node, or not-yet instantiated. In this case it is instantiated. </p>
<div class="fragment"><pre class="fragment">                <span class="keywordflow">for</span> (NodeInfoList::Iterator it = nodes.Begin(); it != nodes.End(); ++it)
                {
                 ...
                }
</pre></div><p>The body of the above for-loop is described in the following paragraphs.</p>
<p>NodeInfo nodeInfo = *it;</p>
<p>Ignore AudioGenerator nodes. </p>
<div class="fragment"><pre class="fragment">                    <span class="keywordflow">if</span> (nodeInfo.GetDescription().Type == <a class="code" href="_xn_types_8h.html#ac773bbb9817dac5ae1be0f380ec18b52a8303fcf880f5c311b1a370c83cae3da3">XN_NODE_TYPE_AUDIO</a>)
                    {
                        <span class="keywordflow">continue</span>;
                    }
</pre></div><p>The following statements use the <a class="el" href="classxn_1_1_node_info.html">xn::NodeInfo</a> object to get a reference to the actual <a class="el" href="classxn_1_1_production_node.html">ProductionNode</a> object. The ProductionNode class is a base class for all production nodes, including all <a class="el" href="classxn_1_1_generator.html">Generator</a> nodes. Thus, the OpenNI Production Graph is comprised entirely of production nodes of one type or another. </p>
<div class="fragment"><pre class="fragment">                    ProductionNode node;
                    nRetVal = nodeInfo.GetInstance(node);
</pre></div><p>The following '<code>if</code>' determines whether the user wants to play back all nodes or just one specific node. The XN_NODE_TYPE_INVALID value for <code>seekNodeType</code> indicates that the user wants to play back all nodes. This value was set in earlier code above. </p>
<div class="fragment"><pre class="fragment">                    <span class="keywordflow">if</span> (seekNodeType == <a class="code" href="_xn_types_8h.html#ac773bbb9817dac5ae1be0f380ec18b52aecbdd244701d5cf6f3333faae8d235dd">XN_NODE_TYPE_INVALID</a>)
</pre></div><p>If the user wants all nodes to be played back and recorded then each and every node iterated by <code>nodeInfo</code> is added to the recorder. <a class="el" href="classxn_1_1_recorder.html#aa6023d6f933e831504c6ddaa8357927f">AddNodeToRecording()</a> adds a node to the recording, and starts recording data that the node generates. </p>
<div class="fragment"><pre class="fragment">                    <span class="keywordflow">if</span> (seekNodeType == <a class="code" href="_xn_types_8h.html#ac773bbb9817dac5ae1be0f380ec18b52aecbdd244701d5cf6f3333faae8d235dd">XN_NODE_TYPE_INVALID</a>)
                    {
                        nRetVal = recorder.AddNodeToRecording(node);
                    }
</pre></div><p>If the user specifies a certain node type, the program selects and records only nodes of that type, <code>seekNodeType</code>, in the run parameter (explained earlier).</p>
<p>The <a class="el" href="classxn_1_1_player.html#adaea321d4b2fd64838e77b72ffb32a0f">SeekToFrame()</a> moves the player to a specific frame of a specific node, e.g., a DepthGenerator node, so it sets up the player so that it will play that node and from that frame onwards. <code>XN_PLAYER_SEEK_SET</code> specifies that the player must start from the frame number, <code>nStartFrame</code>. </p>
<div class="fragment"><pre class="fragment">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (seekNodeType == nodeInfo.GetDescription().Type)
                    {
                        nRetVal = player.SeekToFrame(node.GetName(), nStartFrame, <a class="code" href="_xn_types_8h.html#a580ba965e8eac7ba5f5733e5e2f1ab51aeb039adafb1c0b9c960cb7c75aadbc55">XN_PLAYER_SEEK_SET</a>);
                        nRetVal = recorder.AddNodeToRecording(node);
                    }               
</pre></div><p>In the following, <a class="el" href="classxn_1_1_player.html#a10edc03c5054d09e2134299b13abeb40">SetRepeat()</a> specifies that the player will not automatically rewind to the beginning of the recording after reaching the end of the recording (the default behavior is to rewind). </p>
<div class="fragment"><pre class="fragment">                    nRetVal = player.SetRepeat(<a class="code" href="_xn_platform_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
</pre></div><h3><a class="anchor" id="cnvx2o_main_prog_loop">
- Main Program Loop</a></h3>
<p>Following is the main program loop. It waits for available data from any generator node and records it. The call to the <a class="el" href="classxn_1_1_context.html#a17fab043d7b6d60728511527a1d5c090">context.WaitAnyUpdateAll()</a> method updates all generator nodes in the context to the latest available data, first waiting for any of the nodes to have new data available. Since this method is being fed from a recording, the end of the recording is indicated by returning the XN_STATUS_EOF value.</p>
<p>Note that the <a class="el" href="classxn_1_1_context.html#a17fab043d7b6d60728511527a1d5c090">WaitAnyUpdateAll()</a> method has to be called for each and every loop to refresh the node's data. </p>
<div class="fragment"><pre class="fragment">                <span class="keywordflow">while</span> ((nRetVal = depth.WaitAnyUpdateAll ()) != XN_STATUS_EOF)
                {
                    ...
                }
</pre></div><p>Inside the body of the main program loop <code>nFrame</code> is incremented. An 'if' statement tests whether the user has specified a single node type and if so, and if the requested number of frames has been played back, then the execution of the main program loop is terminated. </p>
<div class="fragment"><pre class="fragment">                printf(<span class="stringliteral">&quot;Recording: %u\r&quot;</span>, nFrame++);
                <span class="keywordflow">if</span> ((seekNodeType != <a class="code" href="_xn_types_8h.html#ac773bbb9817dac5ae1be0f380ec18b52aecbdd244701d5cf6f3333faae8d235dd">XN_NODE_TYPE_INVALID</a>) &amp;&amp; (nFrame == nEndFrame))
                {
                    <span class="keywordflow">break</span>;          
                }
</pre></div> </div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Wed Jun 13 21:55:36 2012 for OpenNI 1.5.4 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
